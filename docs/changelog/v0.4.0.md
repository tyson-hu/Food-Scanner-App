# Changelog - Version 0.4.0

**Release Date**: October 2025  
**Focus**: Enhanced Food Logging and Nutrition Tracking  
**Swift Version**: 6.2 with strict concurrency  
**iOS Target**: 26.0+

## üéØ Version 0.4.0 Overview

Version 0.4.0 focuses on enhanced food logging capabilities and improved nutrition tracking. This release builds upon the solid foundation established in v0.3.0, introducing better food entry management and user experience improvements.

## üîÑ Project Refactoring

### Branding Update
- **Project Rename**: Renamed from "Food Scanner" to "Calry" throughout the project
- **File Updates**: Updated all source files, documentation, and configuration files
- **Test Updates**: Updated all test files to use new Calry branding
- **Documentation**: Comprehensive documentation updates reflecting new branding

### Technical Changes
- **Module Names**: Updated module imports from `Food_Scanner` to `Calry`
- **File Headers**: Updated all Swift file headers to reflect Calry branding
- **Configuration**: Updated SwiftLint configuration for new branding
- **Build System**: Updated Xcode project files and build configurations

### Quality Assurance
- **Linting**: All SwiftLint violations resolved (0 violations)
- **Build**: Successful build with Swift 6 strict concurrency
- **Testing**: All 77 tests passing successfully
- **Code Quality**: Maintained zero lint violations and build warnings

## üÜï New Features

### Today View - Complete Redesign
- **Date Navigation**: Intuitive date picker with navigation controls (prev/next day)
- **Calorie Ring**: Visual calorie progress indicator with target tracking
- **Macro Summary**: Quick overview of protein, fat, and carbs with color coding
- **Meal Sections**: Organized display of entries by meal (Breakfast, Lunch, Dinner, Snacks)
- **Swipe Actions**: Swipe-to-edit and swipe-to-delete functionality for food entries
- **Quick Add Grid**: Fast access to recent and favorite foods with direct logging
- **Live Portion Selection**: Real-time nutrient preview while adjusting portions
- **Daily Totals**: Comprehensive nutrition summary with %DV calculations
- **Edit Entry Flow**: Seamless editing of existing food entries

### Enhanced Food Logging
- **Portion Sheet**: Advanced portion selection with live nutrient calculation
- **Unit Support**: Multiple unit types (grams, servings, household units)
- **Meal Context**: Pre-selected meal context for faster logging
- **Direct Logging**: Quick add functionality using cached preferences
- **Fallback Flow**: Automatic fallback to portion sheet when direct logging isn't possible

### Nutrition Tracking Improvements
- **Daily Value Calculations**: %DV display for key nutrients (protein, fat, carbs, fiber, sodium, cholesterol, added sugars)
- **Added Sugars Support**: New `snapAddedSugars` field with 50g DV baseline
- **Comprehensive Totals**: Complete daily nutrition breakdown
- **Visual Indicators**: Color-coded nutrient displays for better readability

## üîß Technical Improvements

### Architecture Enhancements
- **AppEnvironment Integration**: Centralized dependency injection with `AppEnvironment` and `EnvironmentKey`
- **Theme System**: Comprehensive design system with `AppTheme` (colors, typography, spacing, animations)
- **Component Library**: Reusable UI components (`CalorieRingView`, `SectionHeaderView`, `PrimaryButton`)
- **Sheet Navigation**: Type-safe sheet routing with `SheetRoute` enum
- **DTO Pattern**: Cross-actor data transfer objects for SwiftData integration

### Data Management
- **SwiftData Integration**: Modern data persistence with SwiftData
- **FoodLogStore**: Actor-based data store with `@MainActor` isolation
- **Repository Pattern**: Clean separation between data access and business logic
- **SnapshotNutrientCalculator**: Live nutrient calculation with validation
- **PortionResolver**: Advanced portion-to-grams conversion
- **DVCalculator**: Daily Value percentage calculations with FDA guidelines

### ViewModel Architecture
- **@Observable Pattern**: Modern SwiftUI state management
- **@MainActor Isolation**: Proper concurrency handling for UI-related code
- **TodayViewModel**: Comprehensive state management for Today view
- **PortionSheetViewModel**: Live portion selection with nutrient preview
- **Error Handling**: Robust error handling with user-friendly messages

### Performance & Quality
- **Performance**: Optimized food search and caching
- **Memory Usage**: Reduced memory footprint with proper lifecycle management
- **Concurrency**: Full Swift 6 strict concurrency compliance
- **Code Quality**: Zero SwiftLint violations maintained

## üêõ Bug Fixes

### Barcode Scanning
- **Fixed Redirect Parsing**: Resolved barcode redirect parsing issues
- **Improved Error Handling**: Better error messages for failed scans
- **FDCMock**: Fixed missing `per100Base` nutrients in mock data causing UI test failures and "Log Food" button visibility issues
- **CI Test Runner**: Fixed integer expression error in test counting logic that was causing script failures

### Defensive Programming
- **ProductSourceDetection**: Added `@unknown default` case to switch statements in `detectSupportStatus` methods to prevent potential runtime crashes if additional `SourceTag` enum cases are added in the future
- **Future-Proofing**: Enhanced code robustness to handle potential enum extensions gracefully

### User Interface
- **Layout Fixes**: Resolved layout issues on different screen sizes
- **Accessibility**: Enhanced accessibility support

## üì± User Interface Updates

### Today View
- **Enhanced Dashboard**: Improved daily nutrition overview
- **Better Navigation**: Streamlined navigation between features

### Food Entry Flow
- **Simplified Process**: Cleaner food addition workflow
- **Better Validation**: Improved input validation and feedback

## üîÆ Future Roadmap

### Version 0.5.0 (Planned)
- **Social Features**: Share nutrition goals and achievements
- **Recipe Integration**: Recipe creation and meal planning
- **Advanced Analytics**: Detailed nutrition insights

## üìã Migration Notes

### From Version 0.3.0
- **Automatic Migration**: Seamless data migration from v0.3.0
- **Backward Compatibility**: Full compatibility with existing data
- **Performance**: Improved performance across all features

---

**Version 0.4.0** delivers enhanced food logging capabilities and improved user experience, building a solid foundation for future nutrition tracking features.
